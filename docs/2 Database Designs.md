# 2. Database Designs

# User tables

To store details of all signed-up users. One M Fin users, primarily **Mutual Fund Distributors**

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID (PK) | Unique ID generated by Supabase |
| clerk_id | Text | user id coming from clerk |
| full_name | Text | Full name of the distributor |
| email | Text | Email (can be null if phone-based signup) |
| phone | Text | Phone number |
| auth_provider | Text | “email” / “phone” / “google” |
| created_at | Timestamp | Signup timestamp |
| referral_link | Text | Unique lead form link (e.g. /r/rahul123) |
| profile_image_url | Text | (Optional) profile image |
| settings | JSON | Custom user settings (e.g. AI toggle, product prefs) |
| role | Text | “mfd” or “admin” (for future access control) |

## User table → Lead Table

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID (PK) | Unique lead ID |
| user_id | UUID (FK) | Links to users.id (MFD who owns the lead) |
| full_name | Text | Lead’s full name |
| email | Text | Lead’s email (optional) |
| phone | Text | Lead’s phone number (optional) |
| age | Integer | Age (used in risk profiling) |
| source_link | Text | The referral link used (e.g. r/rahul123) |
| status | Text | ”lead”, “assessment done” , “meeting_scheduled”, “converted”, “dropped” |
| created_at | Timestamp | Lead captured date/time |
| notes | Text | MFD can add meeting notes |
| meeting_id | UUID (FK) | Connects to meetings.id (if booked) |
| risk_profile_id | UUID (FK) | Connects to risk_profiles.id |
| kyc_status | Text | "pending", "incomplete", "completed" |

# Four connected tables

### **Assessments**

What Rahul configures as a “form”. Each MFD can have multiple over time.

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Assessment form ID |
| user_id | UUID | Which MFD created it |
| name | Text | Title like “Default Risk Form” |
| description | Text | Optional |
| is_active | Boolean | Only one active form per MFD |
| created_at | Timestamp |  |

### Assessment Questions

Questions linked to a form

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Question ID |
| assessment_id | UUID | Belongs to which form |
| question_text | Text | The question itself |
| type | Text | "mcq", "scale", "text", etc. |
| options | JSON | For MCQ (optional) |
| weight | Integer | Optional: used in static scoring |

### Risk_Assessment (Responses)

What a lead fills + AI output

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Submission ID |
| lead_id | UUID | Who filled it |
| user_id | UUID | Which MFD |
| assessment_id | UUID | Which form |
| risk_score | Integer | Calculated score |
| risk_category | Text | "low", "medium", "high" |
| ai_used | Boolean | true/false |
| created_at | Timestamp |  |

### Risk Assessment Answers

Each answer in a filled form

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Answer ID |
| risk_assessment_id | UUID | Which submission |
| question_id | UUID | Which question |
| answer_value | Text | Answer given (stringified) |

```jsx
users ───< assessments ───< assessment_questions
   │                           │
   └──< leads ───< risk_assessments ───< risk_assessment_answers
```

## Product Recommendation table

Store a list of mutual fund products that can be:

- Suggested by the **AI engine**
- Edited /customised by the MFD (Rahul)
- Mapped to specific **risk categories**

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID (PK) | Unique product ID |
| user_id | UUID (FK) | Which MFD created/edited it (null if default from system) |
| risk_category | Text | "low", "medium", "high" |
| title | Text | Product name (e.g., “ICICI Prudential Balanced Advantage Fund”) |
| description | Text | Short explanation or selling point |
| amc_name | Text | Asset Management Company name (optional) |
| product_type | Text | "equity", "debt", "hybrid", etc. |
| is_ai_generated | Boolean | Whether it was recommended by AI |
| visibility | Text | "public" or "private" (e.g., only Rahul sees his custom ones) |
| created_at | Timestamp | When it was added |

```jsx
users ───< product_recommendations
           ↑
   risk_assessments ──> suggested products (joined by logic or sub-table)
```

## Meetings Table

Store meeting details between the MFD (Rahul) and the lead — whether scheduled manually or through a calendar integration.

| Field | **Type** | **Description** |
| --- | --- | --- |
| id | UUID (PK) | Unique meeting ID (your internal ID) |
| user_id | UUID (FK) | MFD (Rahul) who owns the meeting |
| lead_id | UUID (FK) | Who the meeting is with |
| external_event_id | Text | Google Calendar event ID |
| platform | Text | "google" |
| meeting_link | Text | Google Meet / Zoom URL |
| title | Text | Event title (from calendar) |
| description | Text | Event body or agenda (from calendar) |
| start_time | Timestamp | Start time (from calendar) |
| end_time | Timestamp | End time (from calendar) |
| status | Text | "scheduled", "completed", "cancelled" (updated via webhook or UI) |
| is_synced | Boolean | Whether fetched via API successfully |
| created_at | Timestamp | Entry created in your DB |

```jsx
leads ───< meetings
```

## Design KYC Status Table

Track KYC completion for each lead — this includes:

- Whether the MFD or the lead filled it
- Which method was used (manual, upload, or 3rd-party)
- Current status

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID (PK) | Unique KYC entry ID |
| lead_id | UUID (FK) | Lead for whom KYC is being tracked |
| user_id | UUID (FK) | MFD responsible |
| kyc_method | Text | "manual_entry", "file_upload", "third_party_api" |
| kyc_file_url | Text | Link to uploaded file (optional) |
| form_data | JSON | Data entered manually (if any) |
| status | Text | "not_started", "in_progress", "submitted", "verified", "rejected" |
| verified_by | Text | "mfd", "admin", "auto" |
| created_at | Timestamp | Entry creation date |
| updated_at | Timestamp | Last status change |

## Subscription Plans

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Plan ID |
| name | Text | "Free", "Starter", "Pro" |
| price_per_month | Decimal | In INR or USD |
| lead_limit | Integer | Max leads per month |
| ai_enabled | Boolean | Can use AI risk analysis |
| custom_form_enabled | Boolean | Can edit risk forms |
| product_edit_enabled | Boolean | Can customize suggestions |
| kyc_enabled | Boolean | Full KYC features access |
| meeting_limit | Integer | Optional: max monthly meetings |
| created_at | Timestamp | When created |

## User Subscriptions

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Entry ID |
| user_id | UUID (FK) | Who is on this plan |
| subscription_plan_id | UUID (FK) | Which plan |
| start_date | Date | When plan started |
| end_date | Date | When it ends (null = active) |
| is_active | Boolean | True if current plan |
| payment_status | Text | "active", "trial", "failed" |
| payment_provider | Text | "razorpay", "stripe", etc. |
| payment_ref_id | Text | External transaction ID |

## Ai_Feedback

| **Field** | **Type** | **Description** |
| --- | --- | --- |
| id | UUID | Entry ID |
| user_id | UUID | Who gave feedback |
| risk_assessment_id | UUID | Which AI suggestion |
| product_ids | JSON | List of suggested products |
| rating | Integer | 1 to 5 |
| comment | Text | Freeform note |
| created_at | Timestamp | Submitted date |

Optional updates later

| **Feature** | **Add-on** |
| --- | --- |
| Aadhaar / PAN verification | Use 3rd-party APIs, store verification_ref_id |
| Expiry tracking | Add expiry_date field |
| Notes / comments | Add notes field for rejected or special cases |

![OneMFin_ER_Diagram_Graphviz.png](2%20Database%20Designs%20248a3da6325c80bd9a2ed9f7042358d1/OneMFin_ER_Diagram_Graphviz.png)